# Lumel Sales Analytics API

REST API for sales data analysis built with .NET 9.

## Quick Start

```bash
# 1. Setup database
# Run Scripts/CreateDatabase.sql in SQL Server

# 2. Update connection string in appsettings.json

# 3. Run
cd Lumel.API/Lumel.API
dotnet run
```

Open `https://localhost:7235/swagger` to test the API.

## Database Schema

```
???????????????????       ???????????????????       ???????????????????
?    Regions      ?       ?    Customers    ?       ?    Products     ?
???????????????????       ???????????????????       ???????????????????
? RegionId (PK)   ?       ? CustomerId (PK) ?       ? ProductId (PK)  ?
? Name            ?       ? Name            ?       ? ProductName     ?
???????????????????       ? Email           ?       ? Category        ?
         ?                ? Address         ?       ? CreatedAt       ?
         ?                ? CreatedAt       ?       ???????????????????
         ?                ???????????????????                ?
         ?                         ?                         ?
         ?    ????????????????????????????????????????       ?
         ?    ?              Orders                  ?       ?
         ?    ????????????????????????????????????????       ?
         ?????? OrderId (PK)                         ?       ?
              ? CustomerId (FK) ??????????????????????       ?
              ? RegionId (FK)                                ?
              ? OrderDate                                    ?
              ? CreatedAt                                    ?
              ????????????????????????????????????????????????
                                 ?
                    ???????????????????????????
                    ?       OrderItems        ?
                    ???????????????????????????
                    ? OrderItemId (PK)        ?
                    ? OrderId (FK)            ?
                    ? ProductId (FK) ??????????
                    ? Quantity                ?
                    ? UnitPrice               ?
                    ? Discount                ?
                    ? ShippingCost            ?
                    ? CreatedAt               ?
                    ???????????????????????????

???????????????????????
?   DataRefreshLog    ?
???????????????????????
? Id (PK)             ?
? StartedAt           ?
? CompletedAt         ?
? Status              ?
? RecordsProcessed    ?
? ErrorMessage        ?
???????????????????????
```

## Endpoints

### Revenue Analysis

```
GET /api/analytics/revenue/total?startDate=2024-01-01&endDate=2024-12-31
GET /api/analytics/revenue/by-product?startDate=2024-01-01&endDate=2024-12-31
GET /api/analytics/revenue/by-category?startDate=2024-01-01&endDate=2024-12-31
GET /api/analytics/revenue/by-region?startDate=2024-01-01&endDate=2024-12-31
```

### Top Products

```
GET /api/analytics/top-products?startDate=2024-01-01&endDate=2024-12-31&topN=5
GET /api/analytics/top-products?startDate=2024-01-01&endDate=2024-12-31&topN=10&category=Electronics
GET /api/analytics/top-products?startDate=2024-01-01&endDate=2024-12-31&topN=10&region=Asia
```

### Data Import

```
POST /api/datarefresh/trigger?filePath=Data/sales_data.csv
GET /api/datarefresh/status
GET /api/datarefresh/history
```

## CSV Format

```csv
Order ID,Product ID,Customer ID,Product Name,Category,Region,Date of Sale,Quantity Sold,Unit Price,Discount,Shipping Cost,Payment Method,Customer Name,Customer Email,Customer Address
1001,P123,C456,Running Shoes,Shoes,North America,2024-01-15,2,180.00,0.1,10.00,Credit Card,John Smith,john@email.com,"123 Main St"
```

## Configuration

```json
{
  "ConnectionStrings": {
    "DbConnection": "Server=.;Database=LumelSalesDb;Trusted_Connection=True;TrustServerCertificate=True"
  },
  "DataRefresh": {
    "IntervalHours": 24,
    "DefaultFilePath": "Data/sales_data.csv"
  }
}
```

## Project Structure

```
Lumel.API            -> Controllers, Program.cs
Lumel.Application    -> DTOs, Interfaces
Lumel.Domain         -> Entities
Lumel.Infrastructure -> DbContext, Services
```

